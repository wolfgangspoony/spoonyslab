{
  "version": 3,
  "sources": ["../keystone.ts", "../schema.ts", "../utils.ts", "../auth.ts"],
  "sourcesContent": ["// This file is what Keystone uses as the entry-point to your headless backend\n//\n// Keystone imports the default export of this file, expecting a Keystone configuration object\n//   you can find out more at https://keystonejs.com/docs/apis/config\nimport dotenv from \"dotenv\";\ndotenv.config();\n\nimport { config } from \"@keystone-6/core\";\n\nimport { lists } from \"./schema\";\n\nimport { withAuth, session } from \"./auth\";\n// import { StorageConfig } from \"@keystone-6/core/types\";\n\nconst {\n\t// DATABASE_URL: databaseUrl = \"\",\n\t// S3_BUCKET_NAME: bucketName = \"\",\n\t// S3_REGION: region = \"\",\n\t// S3_ACCESS_KEY_ID: accessKeyId = \"\",\n\t// S3_SECRET_ACCESS_KEY: secretAccessKey = \"\",\n\t// S3_ENDPOINT: endpoint = \"\",\n\t// S3_CDN_URL: cdnUrl = \"\",\n\tFRONTEND_URL: frontendUrl = \"http://localhost:5173\",\n\tBACKEND_BASE_URL: baseUrl = \"http://localhost:3000\",\n} = process.env;\n\n// ! If this app needs to scale, use this:\n// const defaultStorage: StorageConfig = {\n// \tkind: \"s3\",\n// \ttype: \"file\",\n// \tbucketName,\n// \tregion,\n// \taccessKeyId,\n// \tsecretAccessKey,\n// \tendpoint,\n// \tgenerateUrl: (path: string) => {\n// \t\tconst pathname = new URL(path).pathname;\n// \t\treturn `${cdnUrl}${pathname}`;\n// \t},\n// \tacl: \"public-read\",\n// };\n\nexport default withAuth(\n\tconfig({\n\t\tdb: {\n\t\t\tprovider: \"sqlite\",\n\t\t\turl: \"file:./db/keystone.db\",\n\t\t\t// provider: \"mysql\",\n\t\t\t// url: databaseUrl,\n\t\t\t// additionalPrismaDatasourceProperties: {\n\t\t\t// \trelationMode: \"prisma\",\n\t\t\t// },\n\t\t},\n\t\tserver: {\n\t\t\tcors: {\n\t\t\t\torigin: frontendUrl,\n\t\t\t},\n\t\t},\n\t\tlists,\n\t\tsession,\n\t\tstorage: {\n\t\t\tsongs: {\n\t\t\t\tkind: \"local\",\n\t\t\t\ttype: \"file\",\n\t\t\t\tgenerateUrl: (path) => `${baseUrl}/mixtapes${path}`,\n\t\t\t\tserverRoute: {\n\t\t\t\t\tpath: \"/mixtapes\",\n\t\t\t\t},\n\t\t\t\tstoragePath: \"public/songs\",\n\t\t\t},\n\t\t\timages: {\n\t\t\t\tkind: \"local\",\n\t\t\t\ttype: \"image\",\n\t\t\t\tgenerateUrl: (path) => `${baseUrl}/images${path}`,\n\t\t\t\tserverRoute: {\n\t\t\t\t\tpath: \"/images\",\n\t\t\t\t},\n\t\t\t\tstoragePath: \"public/images\",\n\t\t\t},\n\t\t\t// songs: defaultStorage,\n\t\t\t// images: { ...defaultStorage, type: \"image\" },\n\t\t},\n\t})\n);\n", "// This file is where we define the lists, fields and hooks for our data.\n// If you want to learn more about how lists are configured, please read\n// - https://keystonejs.com/docs/config/lists\n\nimport { list } from \"@keystone-6/core\";\nimport { allowAll } from \"@keystone-6/core/access\";\n\nimport {\n\ttext,\n\tpassword,\n\tcheckbox,\n\timage,\n\tfloat,\n\tfile,\n\trelationship,\n} from \"@keystone-6/core/fields\";\n\nimport { document } from \"@keystone-6/fields-document\";\n\nimport type { Lists } from \".keystone/types\";\nimport { createdAtNowField, isAdmin } from \"./utils\";\n\nexport const lists: Lists = {\n\tUser: list({\n\t\taccess: isAdmin,\n\n\t\tfields: {\n\t\t\tname: text({ validation: { isRequired: true } }),\n\n\t\t\temail: text({\n\t\t\t\tvalidation: { isRequired: true },\n\t\t\t\tisIndexed: \"unique\",\n\t\t\t}),\n\n\t\t\tpassword: password({ validation: { isRequired: true } }),\n\n\t\t\tisAdmin: checkbox(),\n\n\t\t\tcreatedAt: createdAtNowField as any,\n\t\t},\n\t}),\n\n\tSong: list({\n\t\taccess: {\n\t\t\toperation: {\n\t\t\t\tquery: allowAll,\n\t\t\t\tcreate: isAdmin,\n\t\t\t\tupdate: isAdmin,\n\t\t\t\tdelete: isAdmin,\n\t\t\t},\n\t\t},\n\n\t\tui: {\n\t\t\tlabelField: \"title\",\n\t\t},\n\n\t\tfields: {\n\t\t\t// sku: text({\n\t\t\t// \tvalidation: { isRequired: true },\n\t\t\t// \tisIndexed: \"unique\",\n\t\t\t// }),\n\t\t\ttitle: text({ validation: { isRequired: true } }),\n\t\t\tprice: float({ validation: { isRequired: true } }),\n\n\t\t\tthumbnail: image({ storage: \"images\" }),\n\n\t\t\tsongPreview: file({ storage: \"songs\" }),\n\n\t\t\tcreatedAt: createdAtNowField as any,\n\t\t},\n\t}),\n\n\tHomePage: list({\n\t\taccess: {\n\t\t\toperation: {\n\t\t\t\tquery: allowAll,\n\t\t\t\tcreate: isAdmin,\n\t\t\t\tupdate: isAdmin,\n\t\t\t\tdelete: isAdmin,\n\t\t\t},\n\t\t},\n\n\t\tisSingleton: true,\n\n\t\tfields: {\n\t\t\tsplash: image({ storage: \"images\" }),\n\t\t\tsplashPortrait: image({ storage: \"images\" }),\n\t\t},\n\t}),\n\n\tSongsPage: list({\n\t\taccess: {\n\t\t\toperation: {\n\t\t\t\tquery: allowAll,\n\t\t\t\tcreate: isAdmin,\n\t\t\t\tupdate: isAdmin,\n\t\t\t\tdelete: isAdmin,\n\t\t\t},\n\t\t},\n\n\t\tisSingleton: true,\n\n\t\tfields: {\n\t\t\theader: text(),\n\t\t\tfeaturedHeader: text(),\n\t\t\tfeaturedSongs: relationship({\n\t\t\t\tref: \"Song\",\n\t\t\t\tmany: true,\n\t\t\t}),\n\t\t},\n\t}),\n\n\tAboutPage: list({\n\t\taccess: {\n\t\t\toperation: {\n\t\t\t\tquery: allowAll,\n\t\t\t\tcreate: isAdmin,\n\t\t\t\tupdate: isAdmin,\n\t\t\t\tdelete: isAdmin,\n\t\t\t},\n\t\t},\n\n\t\tisSingleton: true,\n\n\t\tfields: {\n\t\t\tcontent: document({\n\t\t\t\tformatting: true,\n\t\t\t\tlinks: true,\n\t\t\t\tdividers: true,\n\t\t\t}),\n\t\t},\n\t}),\n};\n", "import { text, timestamp } from \"@keystone-6/core/fields\";\r\nimport { Session } from \"./types\";\r\n\r\n// Helper function that limits an operation to admin users only\r\nexport const isAdmin = ({ session }: { session?: Session }): boolean => {\r\n\tif (!session || !session.data) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn session.data.isAdmin;\r\n};\r\n\r\nexport const slugResolveInputHook = async ({\r\n\tresolvedData,\r\n}: {\r\n\tresolvedData: any;\r\n}) => {\r\n\tif (resolvedData.name) {\r\n\t\treturn resolvedData.name\r\n\t\t\t.toLowerCase()\r\n\t\t\t.replace(/\\s+/g, \"-\") // Replace spaces with -\r\n\t\t\t.replace(/\\-\\-+/g, \"-\") // Replace multiple - with single -\r\n\t\t\t.replace(/^-+/, \"\") // Trim - from start of text\r\n\t\t\t.replace(/-+$/, \"\"); // Trim - from end of text\r\n\t}\r\n};\r\n\r\nexport const slugField = text({\r\n\tisIndexed: true,\r\n\tui: {\r\n\t\titemView: {\r\n\t\t\tfieldMode: \"hidden\",\r\n\t\t},\r\n\t\tcreateView: {\r\n\t\t\tfieldMode: \"hidden\",\r\n\t\t},\r\n\t},\r\n\thooks: {\r\n\t\tresolveInput: slugResolveInputHook,\r\n\t},\r\n});\r\n\r\nexport const createdAtNowField = timestamp({\r\n\tdefaultValue: \"1970-01-01T00:00:00.000Z\",\r\n\tui: {\r\n\t\titemView: {\r\n\t\t\tfieldMode: \"hidden\",\r\n\t\t},\r\n\t\tcreateView: {\r\n\t\t\tfieldMode: \"hidden\",\r\n\t\t},\r\n\t},\r\n\thooks: {\r\n\t\tresolveInput: async () => {\r\n\t\t\treturn new Date();\r\n\t\t},\r\n\t},\r\n});\r\n", "// Welcome to some authentication for Keystone\n//\n// This is using @keystone-6/auth to add the following\n// - A sign-in page for your Admin UI\n// - A cookie-based stateless session strategy\n//    - Using a User email as the identifier\n//    - 30 day cookie expiration\n//\n// This file does not configure what Users can do, and the default for this starter\n// project is to allow anyone - logged-in or not - to do anything.\n//\n// If you want to prevent random people on the internet from accessing your data,\n// you can find out how by reading https://keystonejs.com/docs/guides/auth-and-access-control\n//\n// If you want to learn more about how our out-of-the-box authentication works, please\n// read https://keystonejs.com/docs/apis/auth#authentication-api\n\n// import { randomBytes } from \"crypto\";\nimport { createAuth } from \"@keystone-6/auth\";\n\n// see https://keystonejs.com/docs/apis/session for the session docs\nimport { statelessSessions } from \"@keystone-6/core/session\";\n\n// for a stateless session, a SESSION_SECRET should always be provided\n//   especially in production (statelessSessions will throw if SESSION_SECRET is undefined)\nlet sessionSecret = process.env.SESSION_SECRET;\n// if (!sessionSecret && process.env.NODE_ENV !== \"production\") {\n// \tsessionSecret = randomBytes(32).toString(\"hex\");\n// }\n\n// withAuth is a function we can use to wrap our base configuration\nconst { withAuth } = createAuth({\n\tlistKey: \"User\",\n\tidentityField: \"email\",\n\n\t// this is a GraphQL query fragment for fetching what data will be attached to a context.session\n\t//   this can be helpful for when you are writing your access control functions\n\t//   you can find out more at https://keystonejs.com/docs/guides/auth-and-access-control\n\tsessionData: \"name createdAt isAdmin\",\n\tsecretField: \"password\",\n\n\t// WARNING: remove initFirstItem functionality in production\n\t//   see https://keystonejs.com/docs/config/auth#init-first-item for more\n\tinitFirstItem: {\n\t\t// if there are no items in the database, by configuring this field\n\t\t//   you are asking the Keystone AdminUI to create a new user\n\t\t//   providing inputs for these fields\n\t\tfields: [\"name\", \"email\", \"password\", \"isAdmin\"],\n\n\t\t// it uses context.sudo() to do this, which bypasses any access control you might have\n\t\t//   you shouldn't use this in production\n\t},\n});\n\n// statelessSessions uses cookies for session tracking\n//   these cookies have an expiry, in seconds\n//   we use an expiry of 30 days for this starter\nconst sessionMaxAge = 60 * 60 * 24 * 30;\n\n// you can find out more at https://keystonejs.com/docs/apis/session#session-api\nconst session = statelessSessions({\n\tmaxAge: sessionMaxAge,\n\tsecret: sessionSecret!,\n});\n\nexport { withAuth, session };\n"],
  "mappings": "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",
  "names": ["import_core", "import_fields", "session", "dotenv"]
}
